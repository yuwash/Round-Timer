"use strict";var INITIAL_STATE={totalRounds:0,roundMinutes:0,roundSeconds:0,restSeconds:0,restMinutes:0,p:10,doPrepare:!0,progressWriteFreq:2},resting=!1,preping=!1,sleeping=!0,doPrepare=INITIAL_STATE.doPrepare,totalSeconds=0,totalElapsedSeconds=0,progressWriteFreq=INITIAL_STATE.progressWriteFreq,prep=null,rest=null,countdown=null,bell=document.getElementById("bell"),ten=document.getElementById("ten"),gong=document.getElementById("gong"),getElapsedProgress=function(){return 0==totalSeconds?0:Math.floor(100*totalElapsedSeconds/totalSeconds)},getLeftProgress=function(){return 100-getElapsedProgress()};!function(a){a.fn.bidigitNumber=function(a){return a%=100,this.text(10>a?"0"+a:a),this}}(jQuery);var TimeDisplay=function(a,b,c){this.minutesElement=a,this.secondsElement=b,this.useSelect=1==c};TimeDisplay.prototype.setMinutes=function(a){this.useSelect||this.minutesElement.bidigitNumber(a)},TimeDisplay.prototype.setSeconds=function(a){this.useSelect||this.secondsElement.bidigitNumber(a)},TimeDisplay.prototype.getMinutes=function(){return parseInt(this.useSelect?this.minutesElement.va():this.minutesElement.text())},TimeDisplay.prototype.getSeconds=function(){return parseInt(this.useSelect?this.secondsElement.val():this.minutesElement.text())};var DisplayedTime=function(a,b,c){this.timeDisplays=a,this.mobileTimeDisplays=b||[],this.onChangeFunction=c||function(){},this.read()};DisplayedTime.prototype.read=function(){if(window.innerWidth<=600&&this.mobileTimeDisplays[0])var a=this.mobileTimeDisplays[0].getMinutes(),b=this.mobileTimeDisplays[0].getSeconds();else var a=this.timeDisplays[0].getMinutes(),b=this.timeDisplays[0].getSeconds();(this.__minutes!=a||this.__seconds!=b)&&(this.__minutes=a,this.__seconds=b,this.onChangeFunction(this.__minutes,this.__seconds))},DisplayedTime.prototype.setMinutes=function(a){if(this.__minutes!=a){this.__minutes=a;for(var b in this.timeDisplays)this.timeDisplays[b].setMinutes(a);for(var b in this.mobileTimeDisplays)this.mobileTimeDisplays[b].setMinutes(a);this.onChangeFunction(this.__minutes,this.__seconds)}},DisplayedTime.prototype.setSeconds=function(a){if(this.__seconds!=a){this.__seconds=a;for(var b in this.timeDisplays)this.timeDisplays[b].setSeconds(a);for(var b in this.mobileTimeDisplays)this.mobileTimeDisplays[b].setSeconds(a);this.onChangeFunction(this.__minutes,this.__seconds)}},DisplayedTime.prototype.pullFrom=function(a){if(a.__seconds!=this.__seconds||a.__minutes!=this.__minutes){this.__seconds=a.__seconds,this.__minutes=a.__minutes;for(var b in this.timeDisplays)this.timeDisplays[b].setSeconds(this.__seconds),this.timeDisplays[b].setMinutes(this.__minutes);for(var b in this.mobileTimeDisplays)this.mobileTimeDisplays[b].setSeconds(this.__seconds),this.mobileTimeDisplays[b].setMinutes(this.__minutes);this.onChangeFunction(this.__minutes,this.__seconds)}},DisplayedTime.prototype.getMinutes=function(){return this.__minutes},DisplayedTime.prototype.getSeconds=function(){return this.__seconds},DisplayedTime.prototype.getTotalSeconds=function(){return 60*this.__minutes+this.__seconds},DisplayedTime.prototype.addSeconds=function(a){var b=this.__seconds+a;if(b>=60||0>b){var c=Math.floor(b/60);if(this.setSeconds(b-60*c),c+=this.__minutes,c>=60)c%=60;else if(0>c){var d=Math.floor(c/60);c-=60*d}this.setMinutes(c)}else this.setSeconds(b)},DisplayedTime.prototype.incSeconds=function(){this.addSeconds(1)},DisplayedTime.prototype.incMinutes=function(){this.setMinutes((this.__minutes+1)%60)},DisplayedTime.prototype.decSeconds=function(){this.addSeconds(-1)},DisplayedTime.prototype.decMinutes=function(){this.setMinutes((this.__minutes+59)%60)},DisplayedTime.getTimeWithNewDisplay=function(a,b,c,d,e){var f=new TimeDisplay(a,b);if(c&&d){var g=new TimeDisplay(c,d,!0);return new DisplayedTime([f],[g],e)}return new DisplayedTime([f],[],e)};var DisplayedCounter=function(a,b){this.displayElement=a,this.onChangeFunction=b||function(){},this.read()};DisplayedCounter.prototype.read=function(){var a=parseInt(this.displayElement.text());this.__counter!=a&&(this.__counter=a,this.onChangeFunction(this.__counter))},DisplayedCounter.prototype.write=function(){this.displayElement.text(this.__counter)},DisplayedCounter.prototype.get=function(){return this.__counter},DisplayedCounter.prototype.set=function(a){this.__counter!=a&&(this.__counter=a,this.write(),this.onChangeFunction(this.__counter))},DisplayedCounter.prototype.inc=function(){this.__counter++,this.write(),this.onChangeFunction(this.__counter)},DisplayedCounter.prototype.dec=function(){this.__counter--,this.write(),this.onChangeFunction(this.__counter)};var ProgressDisplay=function(a,b,c,d){TimeDisplay.call(this,a,b,!1),this.barElement=c,this.getProgress=d||function(){return 0}};ProgressDisplay.prototype=Object.create(TimeDisplay.prototype),ProgressDisplay.prototype.constructor=ProgressDisplay,ProgressDisplay.prototype.setMinutes=function(a){TimeDisplay.prototype.setMinutes.call(this,a),this.writeProgress()},ProgressDisplay.prototype.setSeconds=function(a){TimeDisplay.prototype.setSeconds.call(this,a)},ProgressDisplay.prototype.writeProgress=function(){var a=this.getProgress();this.barElement.css("width",a+"%"),this.barElement.attr("aria-valuenow",a)},$(document).ready(function(){var a=DisplayedTime.getTimeWithNewDisplay($("#round-time #r-minutes"),$("#round-time #r-seconds"),$("#mobile-round-minutes"),$("#mobile-round-seconds")),b=DisplayedTime.getTimeWithNewDisplay($("#rest #rt-minutes"),$("#rest #rt-seconds"),$("#mobile-rest-minutes"),$("#mobile-rest-seconds")),c=DisplayedTime.getTimeWithNewDisplay($("#tminutes"),$("#tseconds"));a.timeDisplays.push(c.timeDisplays[0]);var d=new DisplayedCounter($("#total-rounds")),e=new DisplayedCounter($("#remaining-rounds")),f=new DisplayedCounter($("#ptimer")),g=new ProgressDisplay($("#total-elapsed-progress .minutes"),$("#total-elapsed-progress .seconds"),$("#total-elapsed-progress"),getElapsedProgress),h=new ProgressDisplay($("#total-left-progress .minutes"),$("#total-left-progress .seconds"),$("#total-left-progress"),getLeftProgress),i=function(){if(sleeping)return void(totalElapsedSeconds=0);var f=1+d.get()-e.get(),g=resting?f-1:f,h=f-1;totalElapsedSeconds=g*a.getTotalSeconds()+h*b.getTotalSeconds()-c.getTotalSeconds()},j=function(a,b){if(b%progressWriteFreq==0){i();var c=totalSeconds-totalElapsedSeconds,d=Math.floor(totalElapsedSeconds/60),e=Math.floor(c/60);g.setMinutes(d),g.setSeconds(totalElapsedSeconds%60),h.setMinutes(e),h.setSeconds(c%60)}},k=function(){var c=d.get(),e=Math.max(0,c-1);totalSeconds=c*a.getTotalSeconds()+e*b.getTotalSeconds()};c.onChangeFunction=j,a.onChangeFunction=k,b.onChangeFunction=k,d.onChangeFunction=k,d.set(INITIAL_STATE.totalRounds),a.setMinutes(INITIAL_STATE.roundMinutes),a.setSeconds(INITIAL_STATE.roundSeconds),b.setMinutes(INITIAL_STATE.restMinutes),b.setSeconds(INITIAL_STATE.restSeconds),$("#rounds .plus").click(function(){d.read(),d.inc()}),$("#rounds .minus").click(function(){d.read(),d.get()>0?d.dec():alert("Rounds can not be negative!")}),$("#round-time .plus").click(function(){a.incSeconds()}),$("#round-time .minus").click(function(){a.decSeconds()}),$("#round-time .plus-minutes").click(function(){a.incMinutes()}),$("#round-time .minus-minutes").click(function(){a.decMinutes()}),$("#rest .plus").click(function(){b.incSeconds()}),$("#rest .minus").click(function(){b.decSeconds()}),$("#rest .plus-minutes").click(function(){b.incMinutes()}),$("#rest .minus-minutes").click(function(){b.decMinutes()}),$(".mobile-round-count").change(function(){d.set(parseInt($(this).val())),console.log(d.get())}),$(".mobile-round-minutes").change(function(){a.setMinutes(parseInt($(this).val())),console.log(a.getMinutes())}),$(".mobile-round-seconds").change(function(){a.setSeconds(parseInt($(this).val())),console.log(a.getSeconds())}),$(".mobile-rest-minutes").change(function(){b.setMinutes(parseInt($(this).val())),console.log(b.getMinutes())}),$(".mobile-rest-seconds").change(function(){b.setSeconds(parseInt($(this).val())),console.log(b.getSeconds())}),$("#stop").click(function(){location.reload()}),$("#start").click(function(){r()}),$("#prepare-toggle").change(function(){doPrepare=$("#prepare-toggle").prop("checked")});var l=function(){$("#total-rounds").css("display","none"),$("#remaining-rounds").css("display","inline"),$("#start").attr("disabled","disabled"),$("#ptimer").css("display","inline"),$("#time").css("display","none"),$("#round-counter").css("background-color","yellow"),e.set(d.get()),doPrepare?(f.set(INITIAL_STATE.p),preping=!0):m()},m=function(){$("#ptimer").css("display","none"),$("#time").css("display","inline"),bell.play(),p()},n=function(){gong.play(),resting=!0,e.dec(),c.pullFrom(b),$("#round-counter").css("background-color","red")},o=function(){p(),bell.play()},p=function(){$("#round-counter").removeAttr("style"),resting=!1,preping=!1,c.pullFrom(a),j(0,0)},q=function(){gong.play(),p(),e.set(d.get()),alert("Session Over!"),$("#start").removeAttr("disabled"),$("#total-rounds").css("display","inline"),$("#remaining-rounds").css("display","none")},r=function(){if(sleeping=!1,0==d.get())return void alert("You must set the number of rounds");p(),l();var a=setInterval(function(){preping?(f.dec(),0==f.get()&&m()):c.getTotalSeconds()>0?(c.decSeconds(),resting||10!=c.getTotalSeconds()||ten.play()):resting?o():e.get()<=1?(sleeping=!0,clearInterval(a),q()):n()},1e3)}});