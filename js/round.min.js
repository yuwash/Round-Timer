$(document).ready(function(){"use strict";var a={totalRounds:0,roundMinutes:0,roundSeconds:0,restSeconds:0,restMinutes:0,p:10,doPrepare:!0,progressWriteFreq:2},b=!1,c=!1,d=!0,e=a.doPrepare,f=0,g=0,h=a.progressWriteFreq,i=document.getElementById("bell"),j=document.getElementById("ten"),k=document.getElementById("gong"),l=function(){return 0==f?0:Math.floor(100*g/f)},m=function(){return 100-l()};!function(a){a.fn.bidigitNumber=function(a){return a%=100,this.text(10>a?"0"+a:a),this}}(jQuery);var n=function(a,b,c){this.minutesElement=a,this.secondsElement=b,this.useSelect=1==c};n.prototype.setMinutes=function(a){this.useSelect||this.minutesElement.bidigitNumber(a)},n.prototype.setSeconds=function(a){this.useSelect||this.secondsElement.bidigitNumber(a)},n.prototype.getMinutes=function(){return parseInt(this.useSelect?this.minutesElement.va():this.minutesElement.text())},n.prototype.getSeconds=function(){return parseInt(this.useSelect?this.secondsElement.val():this.minutesElement.text())};var o=function(a,b,c){this.timeDisplays=a,this.mobileTimeDisplays=b||[],this.onChangeFunction=c||function(){},this.read()};o.prototype.read=function(){if(window.innerWidth<=600&&this.mobileTimeDisplays[0])var a=this.mobileTimeDisplays[0].getMinutes(),b=this.mobileTimeDisplays[0].getSeconds();else var a=this.timeDisplays[0].getMinutes(),b=this.timeDisplays[0].getSeconds();(this.__minutes!=a||this.__seconds!=b)&&(this.__minutes=a,this.__seconds=b,this.onChangeFunction(this.__minutes,this.__seconds))},o.prototype.setMinutes=function(a){if(this.__minutes!=a){this.__minutes=a;for(var b in this.timeDisplays)this.timeDisplays[b].setMinutes(a);for(var b in this.mobileTimeDisplays)this.mobileTimeDisplays[b].setMinutes(a);this.onChangeFunction(this.__minutes,this.__seconds)}},o.prototype.setSeconds=function(a){if(this.__seconds!=a){this.__seconds=a;for(var b in this.timeDisplays)this.timeDisplays[b].setSeconds(a);for(var b in this.mobileTimeDisplays)this.mobileTimeDisplays[b].setSeconds(a);this.onChangeFunction(this.__minutes,this.__seconds)}},o.prototype.pullFrom=function(a){if(a.__seconds!=this.__seconds||a.__minutes!=this.__minutes){this.__seconds=a.__seconds,this.__minutes=a.__minutes;for(var b in this.timeDisplays)this.timeDisplays[b].setSeconds(this.__seconds),this.timeDisplays[b].setMinutes(this.__minutes);for(var b in this.mobileTimeDisplays)this.mobileTimeDisplays[b].setSeconds(this.__seconds),this.mobileTimeDisplays[b].setMinutes(this.__minutes);this.onChangeFunction(this.__minutes,this.__seconds)}},o.prototype.getMinutes=function(){return this.__minutes},o.prototype.getSeconds=function(){return this.__seconds},o.prototype.getTotalSeconds=function(){return 60*this.__minutes+this.__seconds},o.prototype.addSeconds=function(a){var b=this.__seconds+a;if(b>=60||0>b){var c=Math.floor(b/60);if(this.setSeconds(b-60*c),c+=this.__minutes,c>=60)c%=60;else if(0>c){var d=Math.floor(c/60);c-=60*d}this.setMinutes(c)}else this.setSeconds(b)},o.prototype.incSeconds=function(){this.addSeconds(1)},o.prototype.incMinutes=function(){this.setMinutes((this.__minutes+1)%60)},o.prototype.decSeconds=function(){this.addSeconds(-1)},o.prototype.decMinutes=function(){this.setMinutes((this.__minutes+59)%60)},o.getTimeWithNewDisplay=function(a,b,c,d,e){var f=new n(a,b);if(c&&d){var g=new n(c,d,!0);return new o([f],[g],e)}return new o([f],[],e)};var p=function(a,b){this.displayElement=a,this.onChangeFunction=b||function(){},this.read()};p.prototype.read=function(){var a=parseInt(this.displayElement.text());this.__counter!=a&&(this.__counter=a,this.onChangeFunction(this.__counter))},p.prototype.write=function(){this.displayElement.text(this.__counter)},p.prototype.get=function(){return this.__counter},p.prototype.set=function(a){this.__counter!=a&&(this.__counter=a,this.write(),this.onChangeFunction(this.__counter))},p.prototype.inc=function(){this.__counter++,this.write(),this.onChangeFunction(this.__counter)},p.prototype.dec=function(){this.__counter--,this.write(),this.onChangeFunction(this.__counter)};var q=function(a,b,c,d){n.call(this,a,b,!1),this.barElement=c,this.getProgress=d||function(){return 0}};q.prototype=Object.create(n.prototype),q.prototype.constructor=q,q.prototype.setMinutes=function(a){n.prototype.setMinutes.call(this,a),this.writeProgress()},q.prototype.setSeconds=function(a){n.prototype.setSeconds.call(this,a)},q.prototype.writeProgress=function(){var a=this.getProgress();this.barElement.css("width",a+"%"),this.barElement.attr("aria-valuenow",a)};var r=o.getTimeWithNewDisplay($("#round-time #r-minutes"),$("#round-time #r-seconds"),$("#mobile-round-minutes"),$("#mobile-round-seconds")),s=o.getTimeWithNewDisplay($("#rest #rt-minutes"),$("#rest #rt-seconds"),$("#mobile-rest-minutes"),$("#mobile-rest-seconds")),t=o.getTimeWithNewDisplay($("#tminutes"),$("#tseconds"));r.timeDisplays.push(t.timeDisplays[0]);var u=new p($("#total-rounds")),v=new p($("#remaining-rounds")),w=new p($("#ptimer")),x=new q($("#total-elapsed-progress .minutes"),$("#total-elapsed-progress .seconds"),$("#total-elapsed-progress"),l),y=new q($("#total-left-progress .minutes"),$("#total-left-progress .seconds"),$("#total-left-progress"),m),z=function(){if(d)return void(g=0);var a=1+u.get()-v.get(),c=b?a-1:a,e=a-1;g=c*r.getTotalSeconds()+e*s.getTotalSeconds()-t.getTotalSeconds()},A=function(a,b){if(b%h==0){z();var c=f-g,d=Math.floor(g/60),e=Math.floor(c/60);x.setMinutes(d),x.setSeconds(g%60),y.setMinutes(e),y.setSeconds(c%60)}},B=function(){var a=u.get(),b=Math.max(0,a-1);f=a*r.getTotalSeconds()+b*s.getTotalSeconds()};t.onChangeFunction=A,r.onChangeFunction=B,s.onChangeFunction=B,u.onChangeFunction=B,u.set(a.totalRounds),r.setMinutes(a.roundMinutes),r.setSeconds(a.roundSeconds),s.setMinutes(a.restMinutes),s.setSeconds(a.restSeconds),$("#rounds .plus").click(function(){u.read(),u.inc()}),$("#rounds .minus").click(function(){u.read(),u.get()>0?u.dec():alert("Rounds can not be negative!")}),$("#round-time .plus").click(function(){r.incSeconds()}),$("#round-time .minus").click(function(){r.decSeconds()}),$("#round-time .plus-minutes").click(function(){r.incMinutes()}),$("#round-time .minus-minutes").click(function(){r.decMinutes()}),$("#rest .plus").click(function(){s.incSeconds()}),$("#rest .minus").click(function(){s.decSeconds()}),$("#rest .plus-minutes").click(function(){s.incMinutes()}),$("#rest .minus-minutes").click(function(){s.decMinutes()}),$(".mobile-round-count").change(function(){u.set(parseInt($(this).val())),console.log(u.get())}),$(".mobile-round-minutes").change(function(){r.setMinutes(parseInt($(this).val())),console.log(r.getMinutes())}),$(".mobile-round-seconds").change(function(){r.setSeconds(parseInt($(this).val())),console.log(r.getSeconds())}),$(".mobile-rest-minutes").change(function(){s.setMinutes(parseInt($(this).val())),console.log(s.getMinutes())}),$(".mobile-rest-seconds").change(function(){s.setSeconds(parseInt($(this).val())),console.log(s.getSeconds())}),$("#stop").click(function(){location.reload()}),$("#start").click(function(){I()}),$("#prepare-toggle").change(function(){e=$("#prepare-toggle").prop("checked")});var C=function(){$("#total-rounds").css("display","none"),$("#remaining-rounds").css("display","inline"),$("#start").attr("disabled","disabled"),$("#ptimer").css("display","inline"),$("#time").css("display","none"),$("#round-counter").css("background-color","yellow"),v.set(u.get()),e?(w.set(a.p),c=!0):D()},D=function(){$("#ptimer").css("display","none"),$("#time").css("display","inline"),i.play(),G()},E=function(){k.play(),b=!0,v.dec(),t.pullFrom(s),$("#round-counter").css("background-color","red")},F=function(){G(),i.play()},G=function(){$("#round-counter").removeAttr("style"),b=!1,c=!1,t.pullFrom(r),A(0,0)},H=function(){k.play(),G(),v.set(u.get()),alert("Session Over!"),$("#start").removeAttr("disabled"),$("#total-rounds").css("display","inline"),$("#remaining-rounds").css("display","none")},I=function(){if(d=!1,0==u.get())return void alert("You must set the number of rounds");G(),C();var a=setInterval(function(){c?(w.dec(),0==w.get()&&D()):t.getTotalSeconds()>0?(t.decSeconds(),b||10!=t.getTotalSeconds()||j.play()):b?F():v.get()<=1?(d=!0,clearInterval(a),H()):E()},1e3)}});